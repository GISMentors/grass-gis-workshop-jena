Unit 12 - Script User Interface
===============================

Standard input
--------------

There is a clear issue related to the script from :doc:`11`. Some
modules (:grasscmd:`r.recode`, :grasscmd:`r.colors`) use hardcoded
paths to the input files. See code below (:option:`rules` option).

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines:  60-68

By PyGRASS a content of input file can be defined as a string object
and transfered to the command via standard input (``stdin_``). See
a sample code below.

.. literalinclude:: ../_static/scripts/ndvi-v3.py
   :language: python
   :lines:  90-100

Note that many of GRASS modules allows sending data via standard input
by option value ``-`` (dash). In our case the both commands with
``rules=-`` option.

.. tip:: Cleanup routine which removes intermediate data by
   :grasscmd:`g.remove` can be also defined.
                   
   .. code-block:: python

      def cleanup():
          Module('g.remove', flags='f', name='region_mask', type='vector')

User interface (UI)
-------------------

The script lacks user input, all input paramaters are
hardcoded. Remember a first modification of the script generated by
Graphical Modeler in :doc:`11`.

At first add previously removed lines back to the script.

.. code-block:: python

   #%module
   #% description: NDVI model version 2
   #%end                

With these lines included a magic will happen, a standardized GUI
dialog appears. Since only module description was defined and no
parameters, the dialog offers only global flags like
:param:`--verbose` or :param:`--quiet`.

.. figure:: ../images/units/12/ndvi-dialog.png
   :class: small
      
   Automatically generated GUI dialog.

Let's define parameters below:

* ``region``: vector map defining a computation region (required)
* ``clouds``: vector map with cloud mask features (required)
* ``red``: input red channel (required)
* ``nir``: input nir channel (required)
* ``threshold``: threshold for removing small areas (optional)
* ``output``: output vector map (required)

UI definition below.
  
.. literalinclude:: ../_static/scripts/ndvi-v3.py
   :language: python
   :lines:  15-40

.. figure:: ../images/units/12/ndvi-dialog-params.png

   GUI dialog with input options.
   
In the script input parameters are still hardcoded, eg.

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines:  28-30

The input parameters are accesible by ``options`` and ``flags``
objects which are generated by ``parse()`` function.

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines:  121

Options and flags are dictionaries, where parameters are accessible by
option keys, see example below.

.. literalinclude:: ../_static/scripts/ndvi-v3.py
   :language: python
   :lines:  58-60

.. note:: All generated (intermediate) maps can be removed when
   computation finished.

   .. literalinclude:: ../_static/scripts/ndvi-v3.py
      :language: python
      :lines:  52-55

.. figure:: ../images/units/12/call-ndvi-script.png
   :class: large
   
   Improved NDVI script in action.

Sample script to download: `ndvi-v3.py <../_static/scripts/ndvi-v3.py>`__
