Unit 12 - Script User Interface
===============================

Standard input
--------------

In the script prepared in :doc:`11` some tools (:grasscmd:`r.recode`,
:grasscmd:`r.colors`) use hardcoded paths to the input files. See code
below (:option:`rules` option):

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines: 72-80

Content of input files can be defined as a string object and transfered
to the command via standard input (``stdin_``). See a sample code
below:

.. literalinclude:: ../_static/scripts/ndvi-v3.py
   :language: python
   :lines:  90-100

Note that many of GRASS modules allows sending data via standard input
by option value ``-`` (dash). In our case the both commands will be
changed to use ``rules="-"`` syntax.

.. task:: Define a cleanup routine to remove intermediate data by
   :grasscmd:`g.remove` tool.
                   
   .. code-block:: python

      def cleanup():
          Module('g.remove', flags='f', name='region_mask', type='vector')

User interface (UI)
-------------------

Let's improve UI generated by Graphical Modeler in :doc:`10`.

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines:  15-25

.. figure:: ../images/units/12/ndvi-dialog.png
   :class: small
      
   Generated GUI dialog with ``voverlay1_ainput`` option.

Let's change UI by defining parameters below:

* ``region``: vector map defining a computation region (required)
* ``clouds``: vector map with cloud mask features (required)
* ``red``: input red channel (required)
* ``nir``: input nir channel (required)
* ``threshold``: threshold for removing small areas (optional)
* ``output``: output vector map (required)

UI definition below.
  
.. literalinclude:: ../_static/scripts/ndvi-v3.py
   :language: python
   :lines:  15-40

.. figure:: ../images/units/12/ndvi-dialog-params.png

   GUI dialog with input options.
   
In the script input parameters are still hardcoded, eg.

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines: 40-45
   :emphasize-lines: 6

Input parameters are accesible by ``options`` and ``flags``
objects which are generated by ``parse()`` function.

.. literalinclude:: ../_static/scripts/ndvi-v2.py
   :language: python
   :lines:  133

Options and flags objects are Python dictionaries, where parameters are
accessible by keys, see example below.

.. literalinclude:: ../_static/scripts/ndvi-v3.py
   :language: python
   :lines:  58-63
   :emphasize-lines: 3, 6
                     
.. task:: All generated (intermediate) maps can be removed when
   computation finished.

   .. literalinclude:: ../_static/scripts/ndvi-v3.py
      :language: python
      :lines:  52-55

.. figure:: ../images/units/12/call-ndvi-script.png
   :class: large
   
   Improved NDVI script in action.

Sample script to download: `ndvi-v3.py <../_static/scripts/ndvi-v3.py>`__
